{% extends 'baselayout.html' %}
{% from 'formhelpers.html' import render_input, render_option %}

{% block caption %}
Anmeldung
{% endblock caption %}


{% block body %}
<div class="row">
    <div class="col-lg-8 col-lg-offset-2">
        <div class="well">
            <form id="signup" class="form-horizontal" method="post" data-persist="garlic">
                {{ form.hidden_tag() }}
                <fieldset>
                    <legend>Persönliche Angaben</legend>
                    {{ render_option(form.sex) }}
                    {{ render_input(form.first_name, placeholder='Max') }}
                    {{ render_input(form.last_name, placeholder='Mustermann') }}
                    {{ render_input(form.phone) }}
                    {# mail needs an help-block because we write the suggestion in it #}
                    {{ render_input(form.mail, placeholder='max.mustermann@example.com', required_extras='data-type="email" data-trigger="change"', help=' ') }}
                    {{ render_option(form.origin) }}
                    {{ render_input(form.tag, required=False, help='Falls Sie kein KIT-Studierender sind und einen Englischkurs belegen wollen, tragen Sie hier die Ihnen vom Sprachenzentrum erteilte ID ein. Mitarbeiter müssen Ihren KIT-Account (login) eintragen.') }}
                </fieldset>
                <fieldset class="kit-only">
                    <legend>Angaben für Studierende des KIT</legend>
                    {{ render_option(form.degree, required=False) }}
                    {{ render_input(form.semester, placeholder='1', type='number', required=False, required_extras='step="1" type="range" min="1" max="26"') }}
                    {{ render_option(form.graduation, required=False) }}
                </fieldset>
                <fieldset>
                    <legend>Kurswahl</legend>
                    {{ render_option(form.course, help='Englischkurse setzen entsprechende Testresultate voraus') }}
                </fieldset>
                <fieldset>
                    <div class="form-group">
                        <div class="col-lg-8 col-lg-offset-2">
                            <button type="submit" class="btn btn-primary">Anmelden</button>
                            <button type="reset"  class="btn btn-default">Zurücksetzen</button>
                        </div>
                    </div>
                </fieldset>
            </form>
        </div>
    </div>
</div>
{% endblock body %}


{% block scripts %}
{{ super() }}
<script>
    "use strict";

    $('#signup').parsley({
        errors: {
            errorsWrapper: '<ul class="list-unstyled"></ul>'
        }
    });
    
    function check_and_change_kit_visibilty(){
        if ($(this).find('option:selected:contains(\'Fakultät\')').length > 0) {
            $('.kit-only').show();
        } else {
            $('.kit-only').hide();
        }
    }
    $(document).ready(function(){
        check_and_change_kit_visibilty();
    });
    $('#origin').change(function() {
        check_and_change_kit_visibilty();
    });

    $('#mail').on('blur', function() {
        $(this).mailcheck({
            domains: mailcheckDomains['domains'],
            topLevelDomains: mailcheckDomains['topLevelDomains'],

            suggested: function(element, suggestion) {
                $('#mail').parent().children('.help-block').html('Meinten Sie <em><a id=\'suggestion\'>' + suggestion['full'] + '</a></em>?');

                $('#suggestion').click(function(e) {
                    $('#mail').val($('#suggestion').text());
                    $('#mail').parent().children('.help-block').empty();
                });
            },

            empty: function(element) {
                $('#mail').parent().children('.help-block').empty();
            }
        });
    });
</script>
{% endblock scripts %}
{# vim: set tabstop=4 shiftwidth=4 expandtab: #}
